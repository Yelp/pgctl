machine:
    environment:
        TOP: $PWD

dependencies:
    pre:
        - sudo apt-get update
    override:
        - sudo apt-get install daemontools
        - pip install --upgrade pip
        - pip install -r requirements.d/CI.txt
        - pre-commit install --install-hooks
    cache_directories:
        - "~/.pip"
        - "~/.pre-commit"
        - "~/.cache"

test:
    override:
        - make test

deployment:
    coverage:
        branch: /.*/
        commands:
            - env
            - coveralls
